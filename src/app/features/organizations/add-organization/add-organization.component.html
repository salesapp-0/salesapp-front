<div class="overlay z-[44]" (click)="close.emit()"></div>
<div class="add-organization">
  <div class="add-organization__wrapper">
    <div class="flex justify-between items-center">
      <h1 class="text-[18px]">{{$isEditMode$() ? 'დაარედაქტირეთ ორგანიზაცია': 'დაამატეთ ორგანიზაცია'}}</h1>
      <img class="cursor-pointer" (click)="close.emit()" src="./assets/images/organizations/close.png" alt="*">
    </div>
    <form
      class="add-organization__wrapper__form"
      [formGroup]="organizationForm"
      (ngSubmit)="onSubmit()"
    >
      <div>
        <div class="add-organization__wrapper__form-item">
          <label for="legalName" class="text-muted">იურიდიული სახელი</label>
          <input pInputText id="legalName" formControlName="legalName" />
          <div *ngIf="f['legalName'].touched && f['legalName'].invalid">
            <small *ngIf="f['legalName'].errors?.['required']">Legal Name is required.</small>
            <small *ngIf="f['legalName'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="tradeName" class="text-muted">სავაჭრო სახელი</label>
          <input pInputText id="tradeName" formControlName="tradeName" />
          <div *ngIf="f['tradeName'].touched && f['tradeName'].invalid">
            <small *ngIf="f['tradeName'].errors?.['required']">Trade Name is required.</small>
            <small *ngIf="f['tradeName'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="identificationCode" class="text-muted">საიდენტიფიკაციო კოდი</label>
          <input pInputText id="identificationCode" formControlName="identificationCode" />
          <div *ngIf="f['identificationCode'].touched && f['identificationCode'].invalid">
            <small *ngIf="f['identificationCode'].errors?.['required']">Identification Code is required.</small>
            <small *ngIf="f['identificationCode'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="legalAddress" class="text-muted">იურიდიული მისამართი</label>
          <input pInputText id="legalAddress" formControlName="legalAddress" />
          <div *ngIf="f['legalAddress'].touched && f['legalAddress'].invalid">
            <small *ngIf="f['legalAddress'].errors?.['required']">Legal Address is required.</small>
            <small *ngIf="f['legalAddress'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>
        <div class="add-organization__wrapper__form-item flex">
          <label for="contactMails" class="text-muted">ინვოისინგის მეილი</label>
          <div class="flex items-center w-full gap-[10px]">
            <p-multiSelect 
            [options]="contactMails" 
            optionLabel="name" 
            formControlName="contactMails"
            />  
                  <img class="w-[24px] cursor-pointer" (click)="$addEmailsPopup$.set(true)" src="./assets/images/organizations/add_circle.svg" alt="">
          </div>
       
        </div>
        <div class="add-organization__wrapper__form-item">
          <label for="actualAddress" class="text-muted">ფაქტობრივი მისამართი</label>
          <input pInputText id="actualAddress" formControlName="actualAddress" />
          <div *ngIf="f['actualAddress'].touched && f['actualAddress'].invalid">
            <small *ngIf="f['actualAddress'].errors?.['required']">Actual Address is required.</small>
            <small *ngIf="f['actualAddress'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>
 
        <div class="add-organization__wrapper__form-item">
          <label class="text-muted">მომსახურების ღირებულება</label>
          <p-inputNumber inputId="serviceCost" formControlName="serviceCost" />
          <div *ngIf="f['serviceCost'].touched && f['serviceCost'].invalid">
            <small *ngIf="f['serviceCost'].errors?.['required']">Service Cost is required.</small>
            <small *ngIf="f['serviceCost'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>
      </div>

      <div>
        <div class="add-organization__wrapper__form-item">
          <label for="paymentDate" class="text-muted">გადახდის თარიღი</label>
          <p-calendar id="paymentDate" formControlName="paymentDate" />
          <div *ngIf="f['paymentDate'].touched && f['paymentDate'].invalid">
            <small *ngIf="f['paymentDate'].errors?.['required']">Payment Date is required.</small>
            <small *ngIf="f['paymentDate'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="bank" class="text-muted">ბანკი</label>
          <input pInputText id="bank" formControlName="bank" />
          <div *ngIf="f['bank'].touched && f['bank'].invalid">
            <small *ngIf="f['bank'].errors?.['required']">Bank is required.</small>
            <small *ngIf="f['bank'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="bankAccountNumber" class="text-muted">საბანკო ანგარიშის ნომერი</label>
          <input pInputText id="bankAccountNumber" formControlName="bankAccountNumber" />
          <div *ngIf="f['bankAccountNumber'].touched && f['bankAccountNumber'].invalid">
            <small *ngIf="f['bankAccountNumber'].errors?.['required']">Bank Account Number is required.</small>
            <small *ngIf="f['bankAccountNumber'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="contactPerson" class="text-muted">საკონტაქტო პირი</label>
          <input pInputText id="contactPerson" formControlName="contactPerson" />
          <div *ngIf="f['contactPerson'].touched && f['contactPerson'].invalid">
            <small *ngIf="f['contactPerson'].errors?.['required']">Contact Person is required.</small>
            <small *ngIf="f['contactPerson'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

        <div class="add-organization__wrapper__form-item">
          <label for="contactPhoneNumber" class="text-muted">საკონტაქტო ტელეფონის ნომერი</label>
          <p-inputNumber id="contactPhoneNumber" inputId="contactPhoneNumber" formControlName="contactPhoneNumber" [useGrouping]="false" />
          <div *ngIf="f['contactPhoneNumber'].touched && f['contactPhoneNumber'].invalid">
            <small *ngIf="f['contactPhoneNumber'].errors?.['required']">Contact Phone Number is required.</small>
            <small *ngIf="f['contactPhoneNumber'].errors?.['minlength']">Minimum 4 characters required.</small>
          </div>
        </div>

  
        

        <div class="add-organization__wrapper__form-item">
          <label for="contactMail" class="text-muted">საკონტაქტო ელფოსტა</label>
          <input pInputText id="contactMail" formControlName="contactMail" />
          <div *ngIf="f['contactMail'].touched && f['contactMail'].invalid">
            <small *ngIf="f['contactMail'].errors?.['required']">Contact Email is required.</small>
            <small *ngIf="f['contactMail'].errors?.['minlength']">Minimum 4 characters required.</small>
            <small *ngIf="f['contactMail'].errors?.['email']">Invalid email format.</small>
          </div>
        </div>
        <div class="mt-[60px]">
          <p-toast />
          <p-fileUpload 
              #fileInput
              mode="basic" 
              chooseLabel="აირჩიე დოკუმენტი" 
              chooseIcon="pi pi-upload"
              name="file"
              url="http://localhost:3000/files/upload" 
              accept=".pdf, .xls, .xlsx,.docx" 
              maxFileSize="1000000" 
              (onUpload)="onUpload($event)"
              (onError)="onError($event)" 
              auto="false"
              />
      </div>
      </div>
  
    </form>

    <div class="add-organization__wrapper-buttons">
      <button (click)="onSubmit()" type="submit" [disabled]="organizationForm.invalid">{{$isEditMode$() ? 'რედაქტირება': 'დამატება'}}</button>
    </div>
  </div>

</div>
@if($addEmailsPopup$()) {
  <app-add-email (thowEmails)="onSetEmail($event)" (close)="$addEmailsPopup$.set(false)"/>
}

